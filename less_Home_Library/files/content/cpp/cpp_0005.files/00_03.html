<head>
    <link rel="stylesheet" href="../../../css/books_style.css">
</head>

<body>
    <div>
        <p><a href="../cpp_0005.html">&lArr;Введение в интерфейс SQLite C/C++</a></p>
        <h1>Как компилировать SQLite</h1>
        <h2>Инструкции и подсказки по компиляции кода SQLite C и интеграции этого кода с вашим собственным приложением.</h2>
        <hr>
        <h2>Обзор</h2>
        <p>SQLite - это исходный код ANSI-C. Он должен быть скомпилирован в машинный код, прежде чем станет полезным. Эта статья представляет собой руководство по различным способам компиляции SQLite.</p>
        <p>В этой статье нет пошагового рецепта компиляции SQLite. Это было бы сложно, поскольку каждая ситуация развития индивидуальна. Скорее, эта статья описывает и иллюстрирует принципы компиляции SQLite. Типичные команды компиляции представлены в качестве
            примеров с ожиданием, что разработчики приложений могут использовать эти примеры в качестве руководства для разработки своих собственных пользовательских процедур компиляции. Другими словами, в этой статье представлены идеи и идеи, а не готовые
            решения. </p>
        <h2>1. Объединение по сравнению с отдельными исходными файлами </h2>
        <p>SQLite построен из более чем сотни файлов кода C и скриптов, разбросанных по нескольким каталогам. Реализация SQLite - это чистый ANSI-C, но многие файлы исходного кода на языке C либо генерируются, либо преобразуются вспомогательными программами
            C и сценариями AWK, SED и TCL до включения в готовую библиотеку SQLite. Создание необходимых программ на C и преобразование и / или создание исходного кода на языке C для SQLite - сложный процесс.</p>
        <p>Чтобы упростить задачу, SQLite также доступен в виде предварительно упакованного файла исходного кода объединения: sqlite3.c. Объединение представляет собой один файл кода ANSI-C, который реализует всю библиотеку SQLite. С объединением справиться
            намного проще. Все содержится в одном файле кода, поэтому его легко добавить в исходное дерево более крупной программы на C или C ++. Все этапы генерации кода и преобразования уже выполнены, поэтому нет никаких вспомогательных программ C,
            которые нужно настраивать и компилировать, и нет скриптов для запуска. А поскольку вся библиотека содержится в одной единице трансляции, компиляторы могут выполнять более сложные оптимизации, приводящие к повышению производительности на 5-10%.
            По этим причинам исходный файл объединения ("sqlite3.c") рекомендуется для всех приложений.</p>
        <p class="font-bold">Использование амальгамации рекомендуется для всех приложений.</p>
        <p>Сборка SQLite непосредственно из отдельных файлов исходного кода, безусловно, возможна, но не рекомендуется. Для некоторых специализированных приложений может потребоваться изменить процесс сборки способами, которые невозможно сделать, используя
            только предварительно созданный исходный файл объединения, загруженный с веб-сайта. В таких ситуациях рекомендуется создать и использовать индивидуальное объединение (как описано ниже). Другими словами, даже если проект требует создания SQLite,
            начиная с отдельных исходных файлов, все же рекомендуется использовать исходный файл объединения в качестве промежуточного шага. </p>
        <h2>2. Компиляция интерфейса командной строки</h2>
        <p>Для сборки интерфейса командной строки требуется три исходных файла: </p>
        <ul>
            <li>
                sqlite3.c: исходный файл объединения SQLite</li>
            <li>sqlite3.h: файлы заголовков, сопровождающие sqlite3.c и определяющие интерфейсы языка C для SQLite.</li>
            <li>shell.c: Сама программа интерфейса командной строки. Это файл исходного кода C, который содержит определение подпрограммы main () и цикла, который запрашивает ввод данных пользователем и передает этот ввод в ядро ​​базы данных SQLite для обработки.</li>
        </ul>
        <p>Все три из вышеперечисленных исходных файлов содержатся в архиве объединения, доступном на странице загрузки.</p>
        <p>Чтобы построить CLI, просто поместите эти три файла в один каталог и скомпилируйте их вместе. Используя MSVC:</p>
        <p><code>cl shell.c sqlite3.c -Fesqlite3.exe</code></p>
        <p>В системах unix (или в Windows с использованием cygwin или mingw + msys) команда обычно выглядит примерно так:</p>
        <p><code>gcc shell.c sqlite3.c -lpthread -ldl -lm</code></p>
        <p>Библиотека pthreads необходима для обеспечения безопасности потоков SQLite. Но поскольку интерфейс командной строки является однопоточным, мы могли бы проинструктировать SQLite о том, что нужно выполнить сборку в небезопасном для потоков режиме
            и тем самым опустить библиотеку pthreads:</p>
        <p><code>gcc -DSQLITE_THREADSAFE = 0 shell.c sqlite3.c -ldl -lm</code></p>
        <p>Библиотека -ldl необходима для поддержки динамической загрузки, интерфейса sqlite3_load_extension() и функции SQL load_extension(). Если эти функции не требуются, их можно опустить, используя параметр времени компиляции SQLITE_OMIT_LOAD_EXTENSION:</p>
        <p><code>gcc -DSQLITE_THREADSAFE = 0 -DSQLITE_OMIT_LOAD_EXTENSION shell.c sqlite3.c</code></p>
        <p>Может потребоваться предоставить другие параметры времени компиляции, такие как -DSQLITE_ENABLE_FTS4 или -DSQLITE_ENABLE_FTS5 для полнотекстового поиска, -DSQLITE_ENABLE_RTREE для расширения поисковой системы R * Tree, -DSQLITE_ENABLE_JSON1 для
            включения функций JSON SQL или -DSQLITE_ENABLE_DBSTAT_Vstat_Vstat_Vstat_Vstat_Vstat_Vstat_Vstat_Vstat_ . Чтобы увидеть дополнительные комментарии в списках EXPLAIN, добавьте параметр -DSQLITE_ENABLE_EXPLAIN_COMMENTS. В системах unix добавьте
            -DHAVE_USLEEP = 1, если хост-машина поддерживает системный вызов usleep (). Добавьте -DHAVE_READLINE и библиотеки -lreadline и -lncurses, чтобы получить поддержку редактирования командной строки. Можно также указать некоторые переключатели
            оптимизации компилятора. (В предварительно скомпилированном интерфейсе командной строки, доступном для загрузки с веб-сайта SQLite, используется «-O».) Здесь существует бесчисленное множество возможных вариантов. Команда для компиляции полнофункциональной
            оболочки может выглядеть примерно так:</p>
        <p><code>gcc -Os -I. -DSQLITE_THREADSAFE = 0 -DSQLITE_ENABLE_FTS4 \
   -DSQLITE_ENABLE_FTS5 -DSQLITE_ENABLE_JSON1 \
   -DSQLITE_ENABLE_RTREE -DSQLITE_ENABLE_EXPLAIN_COMMENTS \
   -DHAVE_USLEEP -DHAVE_READLINE \
   shell.c sqlite3.c -ldl -lm -lreadline -lncurses -o sqlite3</code></p>
        <p>Ключевой момент заключается в следующем: построение интерфейса командной строки состоит из компиляции двух файлов на языке C. Файл shell.c содержит определение точки входа и цикла пользовательского ввода, а объединение SQLite sqlite3.c содержит
            полную реализацию библиотеки SQLite. </p>
        <p></p>
        <p><a href="./00_02.html">Введение в интерфейс SQLite C/C++&rArr;</a></p>
    </div>
</body>