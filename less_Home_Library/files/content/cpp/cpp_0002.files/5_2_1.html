<head>
    <link rel="stylesheet" href="../../css/books_style.css">
</head>

<body>
    <div class="book-title">
        <p><a href="./5_2.html">&lArr;5.2 Копирование и перемещение</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="./5_2_2.html">5.2.2 Перемещение контейнеров&rArr;</a></p>
        <h2>5.2.1. Копирование контейнеров</h2>
        <hr>
        <div>
            <p>Когда класс является дескриптором ресурса, т.е. отвечает за объект, доступ к которому осуществляется через указатель, почленное копирование по умолчанию обычно оказывается катастрофой. Почленная копия будет нарушать инвариант дескриптора ресурса
                (§3.5.2). Например, копирование по умолчанию создало бы копию Vector, ссылающуюся на те же элементы, что и оригинал:</p>
            <img src="./5_2_1_p001.png" alt="">
            <p>В предположении, что vl имеет четыре элемента, графически результат может быть представлен следующим образом.</p>
            <img src="./5_2_1_p002.png" alt="">
            <p>К счастью, тот факт, что Vector имеет деструктор, является важной подсказкой о том, что семантика копирования по умолчанию (почленно) неверна и что компилятор должен хотя бы предупредить об этом. Нам нужно определить лучшую семантику копирования.</p>
            <p>Копирование объекта класса определяется двумя членами: копирующим коиструктором и копирующим присваиваиием: </p>
            <img src="./5_2_1_p003.png" alt="">
            <p>Корректное определение копирующего конструктора для Vector выделяет пространство для необходимого количества элементов, а затем копирует в него элементы, так что после копирования каждый вектор имеет собственную копию элементов:</p>
            <img src="./5_2_1_p004.png" alt="">
            <p>Теперь результат примера v2=vl может быть представлен следующим образом.</p>
            <img src="./5_2_1_p005.png" alt="">
            <p>Конечно, в дополнение к копирующему конструктору нам требуется копирующее присваивание:</p>
            <img src="./5_2_1_p006.png" alt="">
            <p>Имя this в функциях-членах является предопределенным указателем на объект, для которого вызывается эта функция-член.</p>
        </div>
    </div>
</body>