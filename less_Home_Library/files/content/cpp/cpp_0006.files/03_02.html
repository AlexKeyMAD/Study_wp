<head>
    <link rel="stylesheet" href="../../../css/books_style.css">
</head>

<body>
    <div>
        <p><a href="./03_01.html">&lArr;Рисование 2D</a></p>
        <h1>Спрайты и текстуры</h1>
        <hr>
        <h2>Словарь</h2>
        <p>Большинство (если не все) из вас уже знакомы с этими двумя очень распространенными объектами, поэтому давайте дадим им очень краткое определение.</p>
        <p>Текстура — это изображение. Но мы называем это «текстурой», потому что у нее очень специфическая роль: отображение на 2D-объект.</p>
        <p>Спрайт — это не что иное, как текстурированный прямоугольник.</p>
        <img src="./03_02_01.png" alt="" class="border-none">
        <p>Хорошо, это было коротко, но если вы действительно не понимаете, что такое спрайты и текстуры, то вы найдете гораздо лучшее описание в Википедии.</p>
        <hr>
        <h2>Загрузка текстур</h2>
        <p>Перед созданием любого спрайта нам нужна валидная текстура. Удивительно, но класс, который инкапсулирует текстуры в SFML, называется sf::Texture. Поскольку единственной ролью текстуры является загрузка и сопоставление с графическими объектами,
            почти все ее функции связаны с ее загрузкой и обновлением.</p>
        <p>Самый распространенный способ загрузки текстуры — из файла изображения на диске, который выполняется с помощью функции loadFromFile.</p>
        <img src="./03_02_02.png" alt="">
        <div class="atention">
            <p>Иногда функция loadFromFile может дать сбой без видимой причины. Сначала проверьте сообщение об ошибке, которое SFML выводит на стандартный вывод (проверьте консоль). Если в сообщении не удается открыть файл, убедитесь, что рабочий каталог
                (который является каталогом, относительно которого будет интерпретироваться любой путь к файлу) является тем, что вы думаете: когда вы запускаете приложение из среды рабочего стола, рабочий каталог это исполняемая папка. Однако, когда
                вы запускаете свою программу из IDE (Visual Studio, Code::Blocks,...), рабочий каталог иногда может быть установлен вместо каталога проекта. Обычно это можно легко изменить в настройках проекта.</p>
        </div>
        <p>Вы также можете загрузить файл изображения из памяти (loadFromMemory), из пользовательского входного потока (loadFromStream) или из уже загруженного изображения (loadFromImage). Последний загружает текстуру из sf::Image, который является служебным
            классом, помогающим хранить и манипулировать данными изображения (модифицировать пиксели, создавать канал прозрачности и т. д.). Пиксели sf::Image остаются в системной памяти, что гарантирует, что операции с ними будут максимально быстрыми,
            в отличие от пикселей текстуры, которые находятся в видеопамяти и поэтому медленно извлекаются или обновляются, но очень быстро рисовать.</p>
        <p>SFML поддерживает большинство распространенных форматов файлов изображений. Полный список доступен в документации по API.</p>
        <p>Все эти функции загрузки имеют необязательный аргумент, который можно использовать, если вы хотите загрузить меньшую часть изображения.</p>
        <img src="./03_02_03.png" alt="">
        <p>Класс sf::IntRect — это простой служебный тип, представляющий прямоугольник. Его конструктор принимает координаты верхнего левого угла и размер прямоугольника.</p>
        <p>Если вы не хотите загружать текстуру из изображения, а хотите обновить ее непосредственно из массива пикселей, вы можете создать ее пустой и обновить позже:</p>
        <img src="./03_02_04.png" alt="">
        <p>Обратите внимание, что содержимое текстуры в этот момент не определено.</p>
        <p>Чтобы обновить пиксели существующей текстуры, вы должны использовать функцию обновления. Он имеет перегрузки для многих видов источников данных:</p>
        <img src="./03_02_05.png" alt="">
        <p>Во всех этих примерах предполагается, что источник имеет тот же размер, что и текстура. Если это не так, т.е. если вы хотите обновить только часть текстуры, вы можете указать координаты подпрямоугольника, который хотите обновить. Вы можете обратиться
            к документации для получения дополнительной информации.</p>
        <p>Кроме того, у текстуры есть два свойства, которые изменяют способ ее отображения.</p>
        <p>Первое свойство позволяет сгладить текстуру. Сглаживание текстуры делает границы пикселей менее заметными (но изображение становится немного более размытым), что может быть желательно при увеличении масштаба.</p>
        <img src="./03_02_06.png" alt="">
        <img src="./03_02_07.png" alt="" class="border-none">
        <div class="atention">
            <p>Поскольку сглаживание выборок из соседних пикселей в текстуре также может привести к нежелательному побочному эффекту факторизации пикселей за пределами выбранной области текстуры. Это может произойти, когда ваш спрайт расположен в нецелочисленных
                координатах.
            </p>
        </div>
        <p>Второе свойство позволяет повторять текстуру в пределах одного спрайта.</p>
        <img src="./03_02_08.png" alt="">
        <img src="./03_02_09.png" alt="" class="border-none">
        <p>Это работает только в том случае, если ваш спрайт настроен на отображение прямоугольника, который больше текстуры, в противном случае это свойство не действует.</p>
        <hr>
        <h2>Хорошо, теперь я могу получить свой спрайт?</h2>
        <p>Да, теперь вы можете создать свой спрайт.</p>
        <img src="./03_02_10.png" alt="">
        <p>... и, наконец, нарисуйте его.</p>
        <img src="./03_02_11.png" alt="">
        <p>Если вы не хотите, чтобы ваш спрайт использовал всю текстуру, вы можете установить прямоугольник текстуры.</p>
        <img src="./03_02_12.png" alt="">
        <p>Вы также можете изменить цвет спрайта. Установленный вами цвет модулируется (умножается) на текстуру спрайта. Это также можно использовать для изменения глобальной прозрачности (альфа) спрайта.</p>
        <img src="./03_02_13.png" alt="">
        <p>Все эти спрайты используют одну и ту же текстуру, но имеют разный цвет:</p>
        <img src="./03_02_14.png" alt="" class="border-none">
        <p>Спрайты также можно трансформировать: у них есть положение, ориентация и масштаб.</p>
        <img src="./03_02_15.png" alt="">
        <p>По умолчанию источником для этих трех преобразований является верхний левый угол спрайта. Если вы хотите установить начало координат в другой точке (например, в центре спрайта или в другом углу), вы можете использовать функцию setOrigin.</p>
        <img src="./03_02_16.png" alt="">
        <p>Поскольку функции преобразования являются общими для всех сущностей SFML, они объясняются в отдельном руководстве: Преобразование сущностей.</p>
        <hr>
        <h2>Проблема белого квадрата.</h2>
        <p>Вы успешно загрузили текстуру, правильно построили спрайт, и... теперь все, что вы видите на своем экране, это белый квадрат. Что случилось?</p>
        <p>Это распространенная ошибка. Когда вы устанавливаете текстуру спрайта, все, что он внутри делает, это сохраняет указатель на экземпляр текстуры. Поэтому, если текстура уничтожается или перемещается в другое место в памяти, спрайт оказывается с
            недопустимым указателем текстуры.</p>
        <p>Эта проблема возникает, когда вы пишете такую функцию:</p>
        <img src="./03_02_17.png" alt="">
        <p>Вы должны правильно управлять временем жизни ваших текстур и следить за тем, чтобы они жили до тех пор, пока они используются любым спрайтом.</p>
        <hr>
        <h2>Важно использовать как можно меньше текстур</h2>
        <p>Использование как можно меньшего количества текстур — хорошая стратегия, и причина проста: изменение текущей текстуры — дорогостоящая операция для видеокарты. Отрисовка множества спрайтов, использующих одну и ту же текстуру, даст наилучшую производительность.</p>
        <p>Кроме того, использование одной текстуры позволяет сгруппировать статическую геометрию в единый объект (вы можете использовать только одну текстуру для каждого вызова отрисовки), что будет намного быстрее рисовать, чем набор из множества объектов.
            Пакетная обработка статической геометрии включает в себя другие классы и, следовательно, выходит за рамки этого руководства. Дополнительные сведения см. в руководстве по массиву вершин.</p>
        <p>Постарайтесь помнить об этом, когда создаете листы анимации или наборы тайлов: используйте как можно меньше текстур.</p>
        <hr>
        <h2>Использование sf::Texture с кодом OpenGL</h2>
        <p>Если вы используете OpenGL, а не графические объекты SFML, вы все равно можете использовать sf::Texture в качестве оболочки вокруг объекта текстуры OpenGL и использовать его вместе с остальным кодом OpenGL.</p>
        <p>Чтобы привязать sf::Texture для рисования (в основном glBindTexture), вы вызываете статическую функцию привязки:</p>
        <img src="./03_02_18.png" alt="">
        <hr>
        <p><a href="./03_03.html">Текст и шрифты&rArr;</a></p>
    </div>
</body>