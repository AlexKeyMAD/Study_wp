<head>
    <link rel="stylesheet" href="../../../css/books_style.css">
</head>

<body>
    <div>
        <p><a href="./05_03.html">&lArr;Веб-запросы с HTTP</a></p>
        <h1>Передача файлов по FTP</h1>
        <hr>
        <h2>FTP для чайников</h2>
        <p>Если вы знаете, что такое FTP, и просто хотите знать, как использовать класс FTP, предоставляемый SFML, вы можете пропустить этот раздел.</p>
        <p>FTP (протокол передачи файлов) — это простой протокол, позволяющий манипулировать файлами и каталогами на удаленном сервере. Протокол состоит из таких команд, как «создать каталог», «удалить файл», «загрузить файл» и т. д. Вы не можете отправлять
            FTP-команды на любой удаленный компьютер, на нем должен быть запущен FTP-сервер, который может понимать и выполнять команды, которые посылают клиенты.</p>
        <p>Так что же вы можете делать с FTP и чем он может быть полезен для вашей программы? По сути, с помощью FTP вы можете получить доступ к существующим удаленным файловым системам или даже создать свои собственные. Это может быть полезно, если вы хотите,
            чтобы ваша сетевая игра загружала ресурсы (карты, изображения и т. д.) с сервера или чтобы ваша программа автоматически обновлялась при подключении к Интернету.</p>
        <p>Если вы хотите узнать больше о протоколе FTP, статья в Википедии содержит более подробную информацию, чем это краткое введение.</p>
        <hr>
        <h2>Класс FTP-клиента</h2>
        <p>Класс, предоставляемый SFML, — это sf::Ftp (удивительно, не так ли?). Это клиент, что означает, что он может подключаться к FTP-серверу, отправлять ему команды и загружать или скачивать файлы.</p>
        <p>Каждая функция класса sf::Ftp оборачивает команду FTP и возвращает стандартный ответ FTP. Ответ FTP содержит код состояния (похожий на коды состояния HTTP, но не идентичный) и сообщение, информирующее пользователя о том, что произошло. Ответы
            FTP инкапсулируются в классе sf::Ftp::Response.</p>
        <img src="./05_04_01.png" alt="">
        <p>Код состояния можно использовать для проверки того, была ли команда выполнена успешно или нет: коды ниже 400 означают успех, все остальные — ошибки. Вы можете использовать функцию isOk() в качестве ярлыка для проверки кода состояния на успешность.</p>
        <img src="./05_04_02.png" alt="">
        <p>Если вас не волнуют детали ответа, вы можете проверить его успешность с помощью еще меньшего количества кода:</p>
        <img src="./05_04_03.png" alt="">
        <p>Для удобства чтения эти проверки не будут выполняться в следующих примерах этого руководства. Не забудьте выполнить их в своем коде!</p>
        <p>Теперь, когда вы понимаете, как работает класс, давайте посмотрим, что он может делать.</p>
        <hr>
        <h2>Подключение к FTP-серверу</h2>
        <p>Первое, что нужно сделать, это подключиться к FTP-серверу.</p>
        <img src="./05_04_04.png" alt="">
        <p>Адрес сервера может быть любым допустимым. sf::IpAddress: URL-адрес, IP-адрес, сетевое имя, ...</p>
        <p>Стандартный порт для FTP — 21. Если по какой-то причине ваш сервер использует другой порт, вы можете указать его в качестве дополнительного аргумента:</p>
        <img src="./05_04_05.png" alt="">
        <p>Вы также можете передать третий параметр, который представляет собой значение тайм-аута. Это избавляет вас от необходимости ждать вечно (или, по крайней мере, очень долго), если сервер не отвечает.</p>
        <img src="./05_04_06.png" alt="">
        <p>После того, как вы подключитесь к серверу, следующим шагом будет ваша аутентификация:</p>
        <img src="./05_04_07.png" alt="">
        <hr>
        <h2>FTP-команды</h2>
        <p>Вот краткое описание всех команд, доступных в классе sf::Ftp. Помните одну вещь: все эти команды выполняются относительно текущего рабочего каталога, точно так же, как если бы вы выполняли команды файла или каталога в консоли вашей операционной
            системы.
        </p>
        <p>Получение текущего рабочего каталога:</p>
        <img src="./05_04_08.png" alt="">
        <p>sf::Ftp::DirectoryResponse — это специализированный sf::Ftp::Response, который также содержит запрошенный каталог.</p>
        <p>Получение списка каталогов и файлов, содержащихся в текущем каталоге:</p>
        <img src="./05_04_09.png" alt="">
        <p>sf::Ftp::ListingResponse — это специализированный sf::Ftp::Response, который также содержит запрошенные имена каталогов/файлов.</p>
        <p>Изменение текущего каталога:</p>
        <code><p class="cpp_code">ftp.changeDirectory("путь/к/новому_каталогу"); // the given path is relative to the current directory</p></code>
        <p>Переход в родительский каталог текущего:</p>
        <code><p class="cpp_code">ftp.parentDirectory();</p></code>
        <p>Создание нового каталога (как дочернего по отношению к текущему):</p>
        <code><p class="cpp_code">ftp.createDirectory("name_of_new_directory");</p></code>
        <p>Удаление существующего каталога:</p>
        <code><p class="cpp_code">ftp.deleteDirectory("имя_каталога_для_удаления");</p></code>
        <p>Переименование существующего файла:</p>
        <code><p class="cpp_code">ftp.renameFile("старое_имя.txt", "новое_имя.txt");</p></code>
        <p>Удаление существующего файла:</p>
        <code><p class="cpp_code">ftp.deleteFile("имя_файла.txt");</p></code>
        <p>Скачивание (получение с сервера) файла:</p>
        <code><p class="cpp_code">ftp.download("remote_file_name.txt", "local/destination/path", sf::Ftp::Ascii);</p></code>
        <p>Последний аргумент — это режим передачи. Это может быть Ascii (для текстовых файлов), Ebcdic (для текстовых файлов, использующих набор символов EBCDIC) или Binary (для нетекстовых файлов). Режимы Ascii и Ebcdic могут преобразовывать файл (концы
            строк, кодировку) во время передачи в соответствии с клиентской средой. Двоичный режим — это прямая побайтовая передача.</p>
        <p>Загрузка (отправка на сервер) файла:</p>
        <code><p class="cpp_code">ftp.upload("local_file_name.pdf", "remote/destination/path", sf::Ftp::Binary);</p></code>
        <p>FTP-серверы обычно закрывают соединения, которые некоторое время неактивны. Если вы хотите избежать отключения, вы можете периодически отправлять команду no-op:</p>
        <code><p class="cpp_code">ftp.keepAlive();</p></code>
        <hr>
        <h2>Отключение от FTP-сервера</h2>
        <p>Вы можете закрыть соединение с сервером в любой момент с помощью функции отключения.</p>
        <code><p class="cpp_code">ftp.disconnect();</p></code>
        <hr>
        <p><a href="../cpp_0006.html">Содержание&rArr;</a></p>
    </div>
</body>