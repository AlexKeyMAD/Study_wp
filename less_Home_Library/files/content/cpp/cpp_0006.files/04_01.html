<head>
    <link rel="stylesheet" href="../../../css/books_style.css">
</head>

<body>
    <div>
        <p><a href="./03_08.html">&lArr;Управление 2D-камерой с видами</a></p>
        <h1>Воспроизведение звуков и музыки</h1>
        <hr>
        <h2>Звук или музыка?</h2>
        <p>SFML предоставляет два класса для воспроизведения аудио: sf::Sound и sf::Music. Они оба предоставляют более или менее одинаковые функции, главное отличие заключается в том, как они работают.</p>
        <p>sf::Sound — это легкий объект, который воспроизводит загруженные аудиоданные из sf::SoundBuffer. Его следует использовать для небольших звуков, которые могут поместиться в памяти и не должны отставать при воспроизведении. Примерами являются выстрелы
            из оружия, шаги и т. д.</p>
        <p>sf::Music не загружает все аудиоданные в память, а передает их на лету из исходного файла. Обычно он используется для воспроизведения сжатой музыки, которая длится несколько минут, и в противном случае потребовалось бы много секунд для загрузки
            и использования сотен МБ памяти.</p>
        <hr>
        <h2>Загрузка и воспроизведение звука</h2>
        <p>Как упоминалось выше, звуковые данные хранятся не непосредственно в sf::Sound, а в отдельном классе с именем sf::SoundBuffer. Этот класс инкапсулирует аудиоданные, которые в основном представляют собой массив 16-битных целых чисел со знаком (называемых
            «аудиосэмплами»). Сэмпл — это амплитуда звукового сигнала в данный момент времени, поэтому массив сэмплов представляет собой полный звук.</p>
        <div class="atention">
            <p>На самом деле классы sf::Sound/sf::SoundBuffer работают так же, как sf::Sprite/sf::Texture из графического модуля. Итак, если вы понимаете, как спрайты и текстуры работают вместе, вы можете применить ту же концепцию к звукам и звуковым буферам.</p>
        </div>
        <p>Вы можете загрузить звуковой буфер из файла на диске с помощью его функции loadFromFile:</p>
        <img src="./04_01_01.png" alt="">
        <p>Как и во всем остальном, вы также можете загрузить аудиофайл из памяти (loadFromMemory) или из пользовательского входного потока (loadFromStream).</p>
        <p>SFML поддерживает форматы аудиофайлов WAV, OGG/Vorbis и FLAC. Из-за проблем с лицензией MP3 не поддерживается.</p>
        <p>Вы также можете загрузить звуковой буфер непосредственно из массива семплов, если они происходят из другого источника:</p>
        <img src="./04_01_02.png" alt="">
        <p>Поскольку loadFromSamples загружает необработанный массив сэмплов, а не аудиофайл, для полного описания звука требуются дополнительные аргументы. Первый (третий аргумент) — количество каналов; 1 канал определяет монофонический звук, 2 канала определяют
            стереофонический звук и т. д. Второй дополнительный атрибут (четвертый аргумент) — частота дискретизации; он определяет, сколько сэмплов должно воспроизводиться в секунду, чтобы восстановить исходный звук.</p>
        <p>Теперь, когда аудиоданные загружены, мы можем воспроизвести их с помощью экземпляра sf::Sound.</p>
        <img src="./04_01_03.png" alt="">
        <p>Круто то, что вы можете назначить один и тот же звуковой буфер нескольким звукам, если хотите. Вы даже можете играть в них вместе без каких-либо проблем.</p>
        <div class="atention">
            <p>Звуки (и музыка) воспроизводятся в отдельном потоке. Это означает, что вы можете делать все, что хотите, после вызова play() (кроме уничтожения звука или его данных, конечно), звук будет продолжать воспроизводиться до тех пор, пока не закончится
                или явно не остановится.</p>
        </div>
        <hr>
        <h2>Воспроизведение музыки</h2>
        <p>В отличие от sf::Sound, sf::Music не загружает аудиоданные заранее, а передает их прямо из источника. Таким образом, инициализация музыки более прямая:</p>
        <img src="./04_01_04.png" alt="">
        <p>Важно отметить, что, в отличие от всех других ресурсов SFML, функция загрузки называется openFromFile, а не loadFromFile. Это потому, что музыка на самом деле не загружается, эта функция просто открывает ее. Данные загружаются только позже, когда
            играет музыка. Также полезно помнить, что аудиофайл должен оставаться доступным, пока он воспроизводится.</p>
        <p>Другие функции загрузки sf::Music следуют тому же соглашению: openFromMemory, openFromStream.</p>
        <hr>
        <h2>Что дальше?</h2>
        <p>Теперь, когда вы можете загружать и воспроизводить звук или музыку, давайте посмотрим, что вы можете с этим сделать.</p>
        <p>Для управления воспроизведением доступны следующие функции:</p>
        <ul>
            <li><span class="font-bold">play</span> начинает или возобновляет воспроизведение</li>
            <li><span class="font-bold">pause</span> приостанавливает воспроизведение</li>
            <li><span class="font-bold">stop</span> останавливает воспроизведение и перематывает</li>
            <li><span class="font-bold">setPlayingOffset</span> изменяет текущую позицию воспроизведения</li>
        </ul>
        <p>Пример:</p>
        <img src="./04_01_05.png" alt="">
        <p>Функция getStatus возвращает текущий статус звука или музыки, вы можете использовать ее, чтобы узнать, остановлен ли он, воспроизводится или поставлен на паузу.</p>
        <p>Воспроизведение звука и музыки также контролируется несколькими атрибутами, которые можно изменить в любой момент.</p>
        <p>Высота тона — это фактор, который изменяет воспринимаемую частоту звука: больше 1 воспроизводит звук с более высоким тоном, меньше 1 воспроизводит звук с более низким тоном, а 1 оставляет звук без изменений. Изменение высоты тона имеет побочный
            эффект: оно влияет на скорость игры.</p>
        <img src="./04_01_06.png" alt="">
        <p>Громкость... громкость. Значение варьируется от 0 (отключение звука) до 100 (полная громкость). Значение по умолчанию — 100, что означает, что вы не можете сделать звук громче, чем его начальная громкость.</p>
        <img src="./04_01_07.png" alt="">
        <p>Атрибут цикла определяет, будет ли звук/музыка автоматически зацикливаться или нет. Если он зациклится, он возобновит воспроизведение с самого начала, когда закончится, снова и снова, пока вы явно не вызовете остановку. Если не задан цикл, он
            автоматически остановится после завершения.</p>
        <img src="./04_01_08.png" alt="">
        <p>Доступны и другие атрибуты, но они связаны с пространственной и объясняются <span><a href="./04_04.html">в соответствующем руководстве</a></span>.</p>
        <hr>
        <h2>Распространенные ошибки</h2>
        <h4>Разрушенный звуковой буфер</h4>
        <p>Наиболее распространенная ошибка заключается в том, что звуковой буфер выходит за пределы области видимости (и, следовательно, уничтожается), в то время как звук все еще использует его.</p>
        <img src="./04_01_09.png" alt="">
        <p>Помните, что звук хранит только указатель на звуковой буфер, который вы ему даете, он не содержит собственной копии. Вы должны правильно управлять временем жизни ваших звуковых буферов, чтобы они оставались живыми, пока они используются звуками.</p>
        <h4>Слишком много звуков</h4>
        <p>Еще один источник ошибок — это когда вы пытаетесь создать огромное количество звуков. SFML имеет внутреннее ограничение; оно может варьироваться в зависимости от ОС, но никогда не должно превышать 256. Это ограничение представляет собой количество
            экземпляров sf::Sound и sf::Music, которые могут существовать одновременно. Хороший способ не превысить лимит — уничтожить (или переработать) неиспользуемые звуки, когда они больше не нужны. Это применимо только в том случае, если вам нужно
            управлять действительно большим количеством звуков и музыки, конечно.</p>
        <h4>Уничтожение источника музыки во время ее воспроизведения</h4>
        <p>Помните, что музыке нужен источник, пока она играет. Музыкальный файл на вашем диске, вероятно, не будет удален или перемещен во время его воспроизведения вашим приложением, однако все становится сложнее, когда вы воспроизводите музыку из файла
            в памяти или из пользовательского входного потока:</p>
        <img src="./04_01_10.png" alt="">
        <h4>sf::Music нельзя скопировать</h4>
        <p>Последняя «ошибка» — это напоминание: класс sf::Music нельзя копировать, поэтому вам не разрешат это сделать:</p>
        <img src="./04_01_11.png" alt="">
        <p><a href="./04_02.html">Запись аудио&rArr;</a></p>
    </div>
</body>